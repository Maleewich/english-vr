<?xml version="1.0" encoding="UTF-8"?>
<aiml version="2.1">
    
    <category>
        <pattern>cmdNewCharacterSpawned</pattern>
        <template>
            {
                "Actions": "GoToMarket"
            }
        </template>
    </category>

    <category>
        <pattern>cmdReachedMarket</pattern>
        <template>
            <random>
                <li>
                    <think><set name = "fruitType">
                        Apple
                    </set></think>
                    <think><set name = "fruitCount">
                        3
                    </set></think>
                    <think><set name = "phraseAboutType">
                        Apples_male
                    </set></think>
                    <think><set name = "phraseAboutCount">
                        Three_male
                    </set></think>
                </li>
                <li>
                    <think><set name = "fruitType">
                        Melon
                    </set></think>
                    <think><set name = "fruitCount">
                        1
                    </set></think>
                    <think><set name = "phraseAboutType">
                        Melon_male
                    </set></think>
                    <think><set name = "phraseAboutCount">
                        One_male
                    </set></think>
                </li>
            </random>
            {
                "Actions": "SetRequest",
                "Params": ["<get name = "fruitCount"></get>", "<get name = "fruitType"></get>"],
                "VoicePhrases": "trc2_greetings_1 Can_I_Have_Male <get name = "phraseAboutCount"></get> <get name = "phraseAboutType"></get>"
            }
        </template>
    </category>
    
    <category>
        <pattern>cmdBasketOverlapCharacterBegin</pattern>
        <template>
            <think><set name = "topic">startChecking</set></think>
            {
                "Actions": "CheckFruitsCount"
            }
        </template>
    </category>

    <topic name = "startChecking">
        <category>
            <pattern>cmdBasketOverlapCharacterEnd</pattern>
            <template>
                <think><set name = "topic">stopChecking</set></think>
            </template>
        </category>

        <category>
            <pattern>cmdCorrectFruitsCount</pattern>
            <template>
                <think><set name = "topic">startTryTaking</set></think>
                {
                    "Actions": "TryToTakeBasket"
                }
            </template>
        </category>

        <category>
            <pattern>cmdIncorrectFruitsCount</pattern>
            <template>
                <think><set name = "topic">startGrieving</set></think>
                {
                    "Actions": "StartGrieving"
                }
            </template>
        </category>
    </topic>

    <topic name = "startTryTaking">
        <category>
            <pattern>cmdBasketOverlapCharacterEnd</pattern>
            <template>
                {
                    "Actions": "StopTryingToTakeBasket"
                }
            </template>
        </category>
    </topic>
    
    <category>
        <pattern>cmdCanTakeBasket</pattern>
        <template>
            {
                "Actions": "TakeBasket"
            }
        </template>
    </category>
    
    <category>
        <pattern>cmdBasketTaken</pattern>
        <template>
            {
                "Actions": "GoToHome",
                "VoicePhrases": "trc2_goodbye_1"
            }
        </template>
    </category>

</aiml>